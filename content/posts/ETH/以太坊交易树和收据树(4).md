---
title: "以太坊交易树和收据树(4)"
date: 2020-08-24T21:51:47+08:00
tags:
- 区块链
Categories:
- 以太坊

---

### 交易树与状态树

| 状态树                                                       | 交易树                                                       | 收据树                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---------------------------------------------- |
| (把系统中的所有状态都记录进去，不管账户是否与当前区块中的相关交易关联的账户是什么关系) | 区块产生时会生成(类似于BTC中的Merkle交易树，都是把区块中发布的交易组织起俩的) | 交易结束之后会形成一个收据，记录交易的相关信息 |
| MPT树                                                        | MPT树(BTC中的交易树就是普通的Merkle树)                       | MPT树                                          |
| 便于查找(key：账户地址)                                      | 便于查找(key：交易在区块中的编号)                            |                                                |
| 多个区块的状态树是共享节点的                                 | 不共享节点                                                   | 不共享节点                                     |

注意：

- 交易树与收据树上的节点都是一一对应的。
- 增加了收据树，是因为智能合约较为复杂，使用收据树可以继续一些更快速的查询交易的操作，以及一些查看交易结果信息。
  1. 首先收据树也可以提供**Merkle证明**，证明某笔交易被打包至区块中了
  2. Ethereum引入了**bloom filter**的数据结构，支持更加复杂的查询，支持确定某个元素是否在一个较大的集合中（但是有可能出现的问题是有可能本来并不在里面，但是会判断为在里面,也就是false positive），但是Bloom filter不支持删除元素，
- 状态树是共享节点的，只有发布在区块中的交易改变了账户的状态的那些节点需要更新一个分支，其他的节点都是沿用原来的状态树上的节点就行。

每个交易执行完成之后都会有一个收据，每个收据都会有一个bloom filter来记录交易的类型，地址等其他信息，发布的区块的块头中也有一个总的Bloom filter（是这个区块中交易列表的所有交易的bloom filter的并集），所以当需要查找过去十天，与某个智能合约相关的交易的时候，就去查看区块的块头的bloom filter，看是否包含相关交易的bloom filter，如果没有，就说明该区块不是我们想要查询的；如果有，那么就查找这个区块里面包含的交易所对应的收据树里面的bloom filter,

