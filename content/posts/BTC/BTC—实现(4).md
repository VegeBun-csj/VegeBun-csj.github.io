---
title: "BTC—实现(4)"
date: 2020-08-23T20:07:43+08:00
tags:
- 区块链
Categories:
- 比特币
---

# Transaction-based ledger(基于交易)

注：这种账本中每个账户上的余额是不直接显示的，要想知道一个账户上的余额，必须追溯交易的输入输出来推算出账户的余额

### UTXO模型

比特币的全节点需要维护一个叫做**UTXO**的数据结构（**未花费的交易输出——Unspent Transaction Output**）

例如：**一个交易可以有多个输出**，当A账户发起了一笔交易，这笔交易的输出是向B转账了5BTC，向C转账了3BTC，然后B将5BTC花出去了，C没有花费，所以此时向B的输出就不再UTXO中，而向C的输出在UTXO中，所以同一个交易，有的输出在UTXO中，有的交易不在UTXO中。如果有的账户，存在账户余额（比特币），但是始终不花出去，那么这个余额比特币会永远存在于UTXO集合中。

所以**UTXO集合当中的每个元素**，要给出**产生这个输出的交易的hash值**以及它**在这个交易中是第几个输出**，这两个信息可以定位到UTXO集合中某个特定的输出

### 为什么要UTXO这个模型呢？

为了检测Double Spending，也就是说，新产生的交易是否合法，需要查一下UTXO集合，也就是说，某个账户想要花费的币，必须要在UTXO集合当中才是合法的（如果不在UTXO集合中就说明，这个币要么是不存在的，要么是已经花费的）

注：全节点要在内存中维护UTXO集合，以便快速检测Double Spending

### Total inputs = Total outputs

**注：一个交易可以有多个输出，而且也可以有多个输入，这也就是为什么一笔交易有时候需要多笔签名（每个输入地址都要提供对应的签名）**

有些交易的total inputs略微大于total outputs，这里的差额就是**交易费**（用于给获得记账权，发布区块的那个节点），之前还说过矿工打包区块还有**出块奖励**（出块奖励是每21万个块减半，比特币中是每10分钟出一个区块，也就是说每4年，出块奖励减半）。

```为什么要有交易费？
矿工打包区块，网络中有很多交易，为什么要给你的交易打包区块呢，如果没有交易费用，矿工完全可以打包自己的交易获得出块奖励，所以为了避免这种情况，让矿工打包交易，奖励包括：出块奖励和交易费
```



# Account-based ledger(基于账户)

注：这种账本模式下，账户的余额会直接显示（以太坊就是基于这种账本模型），这种类似于平常的银行账户

这两种账本模式，比特币的隐私保护比较好，但是，需要说明币的来源，以太坊就不需要说明币的来源





# 关于比特币的数量

比特币系统中的所有币的总量是：

21万 * 50 + 25万 * 25 + 21万 *12.5 + ...... = 21万 * 50 * （1+1/2+1/4+.....） = 21万 * 100 = 2100万

（其中的50，25，12.5等等是出块奖励）



# 比特币如何保证安全

关于分叉攻击，最长合法链，攻击者让自己花出去的钱回滚。防止这种攻击只需要登带6个区块确认即可，也就是一个小时（因为网络中大部分还是诚实的节点，恶意节点即使分叉了一个区块，但是还要保证接下来的几个区块的记账权还是恶意节点的，所以这个花费的算力还是很大的）

所以通常我们说的区块链是不可篡改的，是一种概率的说法，对于刚刚写入区块链的区块，是比较容易被改的，但是时间越久越不容易改，被篡改的概率会指数级别地下降·